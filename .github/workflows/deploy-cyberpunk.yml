name: ğŸš€ Deploy Cyberpunk Neural Nexus

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages-${{ github.ref }}"
  cancel-in-progress: true

env:
  PYTHON_VERSION: '3.11'
  MKDOCS_VERSION: '1.5.3'

jobs:
  build:
    name: âš¡ Build Cyberpunk Site
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for git-revision-date-localized
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: ğŸ“¦ Install Dependencies
        run: |
          echo "âš¡ Installing MkDocs and dependencies..."
          pip install --upgrade pip
          pip install mkdocs-material
          pip install mkdocs-minify-plugin
          pip install mkdocs-git-revision-date-localized-plugin
          pip install pymdown-extensions
          pip install mkdocs-awesome-pages-plugin
          pip install -r requirements.txt || echo "No additional requirements"
      
      - name: ğŸ¨ Verify Cyberpunk Theme Files
        run: |
          echo "ğŸ” Checking cyberpunk theme files..."
          ls -la docs/stylesheets/ || echo "âš ï¸ Stylesheets directory not found"
          ls -la docs/javascripts/ || echo "âš ï¸ Javascripts directory not found"
          echo "âœ… Theme verification complete"
      
      - name: ğŸ—ï¸ Build MkDocs Site
        run: |
          echo "ğŸš€ Building Neural Nexus with Cyberpunk theme..."
          if [ -f "mkdocs-cyberpunk.yml" ]; then
            mkdocs build --config-file mkdocs-cyberpunk.yml --verbose --strict
          else
            mkdocs build --verbose --strict
          fi
          echo "âœ… Build complete!"
      
      - name: ğŸ”§ Post-Build Optimizations
        run: |
          echo "âš¡ Applying cyberpunk optimizations..."
          # Add custom meta tags for cyberpunk theme
          find site -name "*.html" -type f -exec sed -i 's/<head>/<head>\n<meta name="theme-color" content="#00f3ff">\n<meta name="description" content="Cyberpunk Neural Nexus - ENEM 2026 â†’ UFABC â†’ Computational Neuroscience">/g' {} +
          echo "âœ… Optimizations applied"
      
      - name: ğŸ“Š Site Statistics
        run: |
          echo "ğŸ“Š Site Build Statistics:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "Total files: $(find site -type f | wc -l)"
          echo "HTML files: $(find site -name '*.html' | wc -l)"
          echo "CSS files: $(find site -name '*.css' | wc -l)"
          echo "JS files: $(find site -name '*.js' | wc -l)"
          echo "Site size: $(du -sh site | cut -f1)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      
      - name: ğŸ“¤ Upload Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: site/
          retention-days: 7
  
  deploy:
    name: ğŸŒ Deploy to GitHub Pages
    needs: build
    runs-on: ubuntu-latest
    
    # Only deploy on push to main branch
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
      
      - name: âœ… Deployment Success
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âš¡ NEURAL.NEXUS DEPLOYMENT SUCCESS ///"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸŒ Site URL: ${{ steps.deployment.outputs.page_url }}"
          echo "ğŸ¨ Theme: Cyberpunk 2077 + Blade Runner"
          echo "ğŸ“… Deployed: $(date)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  
  notify:
    name: ğŸ“¢ Deployment Notification
    needs: deploy
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“¢ Status Report
        run: |
          if [ "${{ needs.deploy.result }}" == "success" ]; then
            echo "âœ… Deployment successful!"
            echo "âš¡ Neural Nexus is now live with Cyberpunk theme!"
          else
            echo "âŒ Deployment failed"
            echo "ğŸ”§ Please check the logs above"
          fi
